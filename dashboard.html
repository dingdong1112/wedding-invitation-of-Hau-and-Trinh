<!doctype html>
<html lang="en" data-bs-theme="auto">

<head>
    <!-- Common -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Dashboard Ulems">
    <title>Dashboard Quản Trị</title>

    <!-- Appearance -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#f8f9fa">

    <!-- Font & CSS -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Josefin+Sans&display=swap">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="./css/admin.css">

    <!-- JS Dependencies -->
    <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="./dist/admin.js"></script>
</head>

<!-- Thay link Vercel của bạn vào đây -->

<body data-url="https://wedding-invitation-of-hau-and-chin.vercel.app/">

    <!-- Mobile Nav -->
    <!-- Nav bottom (Mobile - Ứng với 5 tab chức năng) -->
    <nav class="navbar navbar-expand fixed-bottom rounded-top-4 border-top d-md-none d-lg-none d-xl-none p-0">
        <ul class="navbar-nav nav-justified w-100 align-items-center">
            <!-- 1. Thống Kê (Home) -->
            <li class="nav-item">
                <button class="nav-link active" data-bs-toggle="pill" data-bs-target="#pills-home">
                    <i class="fa-solid fa-chart-pie"></i>
                    <span class="d-block" style="font-size: 0.7rem;">Thống Kê</span>
                </button>
            </li>

            <!-- 2. Quản Lý Lời Chúc -->
            <li class="nav-item">
                <button class="nav-link" data-bs-toggle="pill" data-bs-target="#pills-wishes"
                    onclick="undangan.admin.loadWishesManager()">
                    <i class="fa-solid fa-comments"></i>
                    <span class="d-block" style="font-size: 0.7rem;">Lời Chúc</span>
                </button>
            </li>

            <!-- 3. Cài Đặt Trang Khách -->
            <li class="nav-item">
                <button class="nav-link" data-bs-toggle="pill" data-bs-target="#pills-setting">
                    <i class="fa-solid fa-sliders"></i>
                    <span class="d-block" style="font-size: 0.7rem;">Cài Đặt</span>
                </button>
            </li>

            <!-- 4. Bảo Mật & Token -->
            <li class="nav-item">
                <button class="nav-link" data-bs-toggle="pill" data-bs-target="#pills-security">
                    <i class="fa-solid fa-user-shield"></i>
                    <span class="d-block" style="font-size: 0.7rem;">Bảo Mật</span>
                </button>
            </li>

            <!-- 5. Đăng Xuất (LOGOUT) -->
            <li class="nav-item">
                <button class="nav-link logout" onclick="undangan.admin.logout()">
                    <i class="fa-solid fa-right-from-bracket"></i>
                    <span class="d-block" style="font-size: 0.7rem;">Thoát</span>
                </button>
            </li>
        </ul>
    </nav>

    <!-- Main Content -->
    <main class="container mt-4 mb-5">
        <!-- Header -->
        <div class="d-none d-sm-flex justify-content-between align-items-center mt-4 mb-5 pt-1">
            <h4 class="m-0 p-0 flex-grow-1 fw-bold">Admin Panel <i class="fa-solid fa-fire text-danger ms-2"></i></h4>
            <div class="m-0 p-0 flex-grow-1 text-end" id="dashboard-name" style="font-size: 1.4rem;">Admin</div>
        </div>

        <div class="row m-0 p-0">
            <!-- MENU TRÁI (Desktop) -->
            <div class="col-md-3 d-none d-md-block m-0 p-0">
                <ul class="nav flex-column w-100 nav-pills pe-4" id="admin-tabs" role="tablist">
                    <li class="nav-item pe-2">
                        <button
                            class="btn-theme-auto nav-link w-100 text-start fw-semibold mb-1 rounded-4 shadow-sm active"
                            data-bs-toggle="pill" data-bs-target="#pills-home">
                            <i class="fa-solid fa-chart-pie ms-3 me-2"></i>Thống Kê
                        </button>
                    </li>
                    <li class="nav-item pe-2">
                        <button class="btn-theme-auto nav-link w-100 text-start fw-semibold my-1 rounded-4 shadow-sm"
                            data-bs-toggle="pill" data-bs-target="#pills-wishes"
                            onclick="undangan.admin.loadWishesManager()">
                            <i class="fa-solid fa-comments ms-3 me-2"></i>Quản Lý Lời Chúc
                        </button>
                    </li>
                    <li class="nav-item pe-2">
                        <button class="btn-theme-auto nav-link w-100 text-start fw-semibold my-1 rounded-4 shadow-sm"
                            data-bs-toggle="pill" data-bs-target="#pills-setting">
                            <i class="fa-solid fa-sliders ms-3 me-2"></i>Cài Đặt Trang Khách
                        </button>
                    </li>
                    <li class="nav-item pe-2">
                        <button class="btn-theme-auto nav-link w-100 text-start fw-semibold my-1 rounded-4 shadow-sm"
                            data-bs-toggle="pill" data-bs-target="#pills-security">
                            <i class="fa-solid fa-user-shield ms-3 me-2"></i>Bảo Mật & Token
                        </button>
                    </li>
                    <li class="nav-item pe-2">
                        <hr class="my-2">
                    </li>
                    <li class="nav-item pe-2">
                        <button
                            class="btn-theme-auto logout nav-link w-100 text-start fw-semibold mt-1 rounded-4 shadow-sm"
                            onclick="undangan.admin.logout()">
                            <i class="fa-solid fa-right-from-bracket ms-3 me-2"></i>Đăng Xuất
                        </button>
                    </li>
                </ul>
            </div>

            <!-- NỘI DUNG PHẢI -->
            <div class="col-md-9 m-0 p-0">
                <div class="tab-content">

                    <!-- 1. HOME -->
                    <section class="tab-pane fade show active" id="pills-home">
                        <div class="rounded-4 p-3 mb-4 shadow bg-body-secondary">
                            <h5 class="fw-bold m-0"><i class="fa-solid fa-home me-2"></i>Tổng Quan</h5>
                        </div>

                        <!-- Stats Cards -->
                        <div class="row g-3">
                            <div class="col-6 col-xl-3">
                                <div class="rounded-4 shadow p-3 border-0 text-white" style="background: #8573F1;">
                                    <p class="fw-bold m-0">Tổng Lời Chúc</p>
                                    <h3 class="fw-bold m-0" id="count-comment">0</h3>
                                </div>
                            </div>
                            <div class="col-6 col-xl-3">
                                <div class="rounded-4 shadow p-3 border-0 text-white" style="background: #7A5CD9;">
                                    <p class="fw-bold m-0">Tham Dự</p>
                                    <h3 class="fw-bold m-0" id="count-present">0</h3>
                                </div>
                            </div>
                            <div class="col-6 col-xl-3">
                                <div class="rounded-4 shadow p-3 border-0 text-white" style="background: #6546B1;">
                                    <p class="fw-bold m-0">Vắng Mặt</p>
                                    <h3 class="fw-bold m-0" id="count-absent">0</h3>
                                </div>
                            </div>
                            <div class="col-6 col-xl-3">
                                <div class="rounded-4 shadow p-3 border-0 text-white" style="background: #4F3392;">
                                    <p class="fw-bold m-0">Thích</p>
                                    <h3 class="fw-bold m-0" id="count-like">0</h3>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- 2. WISHES MANAGER -->
                    <section class="tab-pane fade" id="pills-wishes">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="fw-bold"><i class="fa-solid fa-comments me-2"></i>Danh Sách Lời Chúc</h5>
                            <button class="btn btn-success btn-sm rounded-pill shadow-sm"
                                onclick="undangan.admin.openAddWishModal()">
                                <i class="fa-solid fa-plus me-1"></i>Thêm Mới
                            </button>
                        </div>
                        <div id="wishes-manager-list" class="d-flex flex-column gap-3"></div>
                    </section>

                    <!-- 3. SETTINGS -->
                    <section class="tab-pane fade" id="pills-setting">
                        <div class="card p-4 shadow-sm rounded-4 border-0 bg-theme-auto">
                            <h5 class="mb-4 fw-bold border-bottom pb-2">Điều Khiển Giao Diện Khách</h5>

                            <!-- Các nút Switch -->
                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input" type="checkbox" id="toggle-confetti"
                                    onchange="undangan.admin.updateConfig('confetti_enabled', this.checked)">
                                <label class="form-check-label" for="toggle-confetti">Hiệu ứng Pháo hoa
                                    (Confetti)</label>
                            </div>
                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input" type="checkbox" id="toggle-particles"
                                    onchange="undangan.admin.updateConfig('particle_control_enabled', this.checked)">
                                <label class="form-check-label" for="toggle-particles">Hiển thị Đũa Thần (Chỉnh hiệu
                                    ứng)</label>
                            </div>
                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input" type="checkbox" id="toggle-vinyl"
                                    onchange="undangan.admin.updateConfig('vinyl_enabled', this.checked)">
                                <label class="form-check-label" for="toggle-vinyl">Hiệu ứng Đĩa Nhạc Quay</label>
                            </div>
                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input" type="checkbox" id="toggle-music"
                                    onchange="undangan.admin.updateConfig('music_enabled', this.checked)">
                                <label class="form-check-label" for="toggle-music">Tự động phát nhạc & Hiển thị
                                    Player</label>
                            </div>
                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input" type="checkbox" id="toggle-popup"
                                    onchange="undangan.admin.updateConfig('wishes_popup_enabled', this.checked)">
                                <label class="form-check-label" for="toggle-popup">Popup Lời Chúc Chạy Ngẫu
                                    Nhiên</label>
                            </div>
                            <hr>
                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input bg-danger border-danger" type="checkbox" id="toggle-lock"
                                    onchange="undangan.admin.updateConfig('can_delete', this.checked)">
                                <label class="form-check-label text-danger fw-bold" for="toggle-lock">KHÓA chức năng Gửi
                                    Lời Chúc (Bảo Trì)</label>
                            </div>
                        </div>
                    </section>

                    <!-- 4. SECURITY -->
                    <section class="tab-pane fade" id="pills-security">
                        <div class="p-4 bg-theme-auto mb-3 rounded-4 shadow">
                            <p class="fw-bold border-bottom pb-2"><i class="fa-solid fa-key me-2"></i>Access Key (Token)
                            </p>
                            <div class="input-group mb-3">
                                <input type="password" class="form-control" id="dashboard-accesskey" readonly value="">
                                <button class="btn btn-outline-secondary" type="button"
                                    onclick="window.toggleTokenVisibility()">
                                    <i class="fa-solid fa-eye" id="eye-icon"></i>
                                </button>
                                <button class="btn btn-outline-secondary" type="button" onclick="window.copyToken()">
                                    <i class="fa-solid fa-copy"></i>
                                </button>
                            </div>
                            <div class="text-end">
                                <button class="btn btn-warning btn-sm rounded-pill shadow-sm"
                                    onclick="window.regenerateToken()">
                                    <i class="fa-solid fa-rotate me-1"></i> Tạo Token Mới
                                </button>
                            </div>
                        </div>

                        <div class="p-4 bg-theme-auto mb-3 rounded-4 shadow">
                            <p class="fw-bold border-bottom pb-2"><i class="fa-solid fa-lock me-2"></i>Đổi Mật Khẩu
                                Admin</p>
                            <div class="mb-3">
                                <label class="form-label small text-muted">Mật khẩu cũ</label>
                                <input type="password" class="form-control rounded-4" id="old_password">
                            </div>
                            <div class="mb-3">
                                <label class="form-label small text-muted">Mật khẩu mới</label>
                                <input type="password" class="form-control rounded-4" id="new_password">
                            </div>
                            <div class="text-end">
                                <button class="btn btn-primary btn-sm rounded-pill shadow-sm"
                                    onclick="undangan.admin.changePassword(this)">
                                    Lưu Mật Khẩu
                                </button>
                            </div>
                        </div>
                    </section>

                </div>
            </div>
        </div>
    </main>

    <!-- MODAL LOGIN -->
    <div class="modal fade" id="mainModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content rounded-4 shadow-lg">
                <div class="modal-body p-4">
                    <h4 class="text-center fw-bold mb-4">Đăng Nhập Admin</h4>
                    <form id="admin-login-form"
                        onsubmit="event.preventDefault(); undangan.admin.auth.login(this.querySelector('button[type=submit]'))">
                        <div class="mb-4">
                            <label for="admin-pass" class="form-label fw-bold">Mật khẩu</label>
                            <input type="password" class="form-control form-control-lg rounded-4" id="admin-pass"
                                placeholder="••••••••" required autocomplete="current-password">
                        </div>
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary btn-lg rounded-4 fw-bold">Login</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL SỬA/THÊM LỜI CHÚC -->
    <div class="modal fade" id="editWishModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content rounded-4">
                <div class="modal-header border-0">
                    <h5 class="modal-title fw-bold">Thông Tin Lời Chúc</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="edit-wish-id">
                    <div class="mb-3">
                        <label class="form-label small text-muted">Tên Khách</label>
                        <input type="text" class="form-control rounded-4" id="edit-wish-name">
                    </div>
                    <div class="mb-3">
                        <label class="form-label small text-muted">Lời Chúc</label>
                        <textarea class="form-control rounded-4" id="edit-wish-msg" rows="4"></textarea>
                    </div>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-light rounded-pill" data-bs-dismiss="modal">Hủy</button>
                    <button type="button" class="btn btn-primary rounded-pill px-4"
                        onclick="undangan.admin.saveWish()">Lưu Lại</button>
                </div>
            </div>
        </div>
    </div>

</body>

</html>