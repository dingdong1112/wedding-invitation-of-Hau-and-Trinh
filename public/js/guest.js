(()=>{var V=(()=>{let l=null,i=null,f=0,s=0,h=!0,n=null,g=()=>{f+=1},E=()=>`(${s}/${f}) [${parseInt(s/f*100).toFixed(0)}%]`;return{init:()=>{l=document.getElementById("progress-info"),i=document.getElementById("progress-bar"),l.classList.remove("d-none"),n=new Promise(r=>document.addEventListener("undangan.progress.invalid",r))},add:g,invalid:r=>{h&&(h=!1,i.style.backgroundColor="red",l.innerText=`Error loading ${r} ${E()}`,document.dispatchEvent(new Event("undangan.progress.invalid")))},complete:(r,C=!1)=>{h&&(s+=1,l.innerText=`Loading ${r} ${C?"skipped":"complete"} ${E()}`,i.style.width=Math.min(s/f*100,100).toString()+"%",s===f&&(h=!1,n=null,document.dispatchEvent(new Event("undangan.progress.done"))))},getAbort:()=>n}})();var b=(()=>{let l='<span class="spinner-border spinner-border-sm my-0 ms-0 me-1 p-0" style="height: 0.8rem; width: 0.8rem;"></span>',i=[["*",'<strong class="text-theme-auto">$1</strong>'],["_",'<em class="text-theme-auto">$1</em>'],["~",'<del class="text-theme-auto">$1</del>'],["```",'<code class="font-monospace text-theme-auto">$1</code>']],f=[{type:"Mobile",regex:/Android.*Mobile|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i},{type:"Tablet",regex:/iPad|Android(?!.*Mobile)|Tablet/i},{type:"Desktop",regex:/Windows NT|Macintosh|Linux/i}],s=[{name:"Chrome",regex:/Chrome|CriOS/i},{name:"Safari",regex:/Safari/i},{name:"Edge",regex:/Edg|Edge/i},{name:"Firefox",regex:/Firefox|FxiOS/i},{name:"Opera",regex:/Opera|OPR/i},{name:"Internet Explorer",regex:/MSIE|Trident/i},{name:"Samsung Browser",regex:/SamsungBrowser/i}],h=[{name:"Windows",regex:/Windows NT ([\d.]+)/i},{name:"MacOS",regex:/Mac OS X ([\d_.]+)/i},{name:"Android",regex:/Android ([\d.]+)/i},{name:"iOS",regex:/OS ([\d_]+) like Mac OS X/i},{name:"Linux",regex:/Linux/i},{name:"Ubuntu",regex:/Ubuntu/i},{name:"Chrome OS",regex:/CrOS/i}],n=e=>String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),g=e=>{let o=y=>{window.alert(`${y} ${e}`)};return{success:()=>o("\u{1F7E9}"),error:()=>o("\u{1F7E5}"),warning:()=>o("\u{1F7E8}"),info:()=>o("\u{1F7E6}"),custom:y=>o(y)}},E=e=>window.confirm(`\u{1F7E6} ${e}`),v=(e,o)=>(e.replaceChildren(document.createRange().createContextualFragment(o)),e),$=(e,o,y=.05)=>new Promise(L=>{let U=parseFloat(e.style.opacity),W=o?1:0,G=()=>{U+=o?y:-y,U=Math.max(0,Math.min(1,U)),e.style.opacity=U.toFixed(2),o&&U>=W||!o&&U<=W?(e.style.opacity=W.toString(),L(e)):requestAnimationFrame(G)};requestAnimationFrame(G)}),B=(e,o=0)=>{let y=null;y=setTimeout(()=>{e(),clearTimeout(y),y=null},o)};return{loader:l,ask:E,copy:async(e,o=null,y=1500)=>{let L=e.getAttribute("data-copy");if(!L||L.length===0){g("Nothing to copy").warning();return}e.disabled=!0;try{await navigator.clipboard.writeText(L)}catch{e.disabled=!1,g("Failed to copy").error();return}let U=e.innerHTML;v(e,o||'<i class="fa-solid fa-check"></i>'),B(()=>{e.disabled=!1,e.innerHTML=U},y)},notify:g,timeOut:B,debounce:(e,o=100)=>{let y=null;return(...L)=>{clearTimeout(y),y=setTimeout(()=>e(...L),o)}},escapeHtml:n,base64Encode:e=>{let y=new TextEncoder().encode(e);return window.btoa(String.fromCharCode(...y))},base64Decode:e=>{let o=new TextDecoder,y=Uint8Array.from(window.atob(e),L=>L.charCodeAt(0));return o.decode(y)},disableButton:(e,o="Loading",y=!1)=>{e.disabled=!0;let L=e.innerHTML;return v(e,y?o:l+o),{restore:(U=!1)=>{e.innerHTML=L,e.disabled=U}}},disableCheckbox:e=>{e.disabled=!0;let o=document.querySelector(`label[for="${e.id}"]`),y=o.innerHTML;return v(o,l+y),{restore:()=>{o.innerHTML=y,e.disabled=!1}}},safeInnerHTML:v,parseUserAgent:e=>{if(!e||typeof e!="string")return"Unknown";let o=f.find(G=>G.regex.test(e))?.type??"Unknown",y=s.find(G=>G.regex.test(e))?.name??"Unknown",L=h.find(G=>G.regex.test(e)),U=L?L.name:"Unknown",W=L?e.match(L.regex)?.[1]?.replace(/_/g,".")??null:null;return`${y} ${o} ${W?`${U} ${W}`:U}`},changeOpacity:$,getGMTOffset:e=>{let o=new Date,y=new Intl.DateTimeFormat("en-US",{timeZone:e,hourCycle:"h23",hour:"numeric"}),L=(parseInt(y.format(o))-o.getUTCHours()+24)%24;return L>12&&(L-=24),`GMT${L>=0?"+":""}${L}`},convertMarkdownToHTML:e=>(i.forEach(([o,y])=>{e=e.replace(new RegExp(`\\${o}(\\S(?:[\\s\\S]*?\\S)?)\\${o}`,"g"),y)}),e)}})();var xe="POST";var Le="DELETE";var he="AbortError",He="TypeError",pe={Accept:"application/json","Content-Type":"application/json"},Ie="request",we=(()=>{let l=null;return{getInstance:i=>{if(!l||!l.has(i))throw new Error(`please init cache first: ${i}`);return l.get(i)},restart:async i=>{l.set(i,null),l.delete(i),await window.caches.delete(i),await window.caches.open(i).then(f=>l.set(i,f))},init:(i,f=[])=>{if(!window.isSecureContext)throw new Error("this application required secure context");l=new Map,Promise.all(f.concat([Ie]).map(s=>window.caches.open(s).then(h=>l.set(s,h)))).then(()=>i())}}})(),be=l=>{let i=we.getInstance(l);return{set:(n,g,E,v)=>g.clone().arrayBuffer().then($=>{if(!g.ok)return g;let B=new Date,t=new Headers(g.headers);if(t.has("Date")||t.set("Date",B.toUTCString()),E||!t.has("Cache-Control")){if(!E&&t.has("Expires")){let r=new Date(t.get("Expires"));v=Math.max(0,r.getTime()-B.getTime())}if(v===0)throw new Error("Cache max age cannot be 0");t.set("Cache-Control",`public, max-age=${Math.floor(v/1e3)}`)}return t.has("Content-Length")||t.set("Content-Length",String($.byteLength)),i.put(n,new Response($,{headers:t})).then(()=>g)}),has:n=>i.match(n).then(g=>{if(!g)return null;let E=g.headers.get("Cache-Control").match(/max-age=(\d+)/)[1],v=Date.parse(g.headers.get("Date"))+parseInt(E)*1e3;return Date.now()>v?null:g}),del:n=>i.delete(n)}},te=(l,i)=>{let f=new AbortController,s={signal:f.signal,credential:"include",headers:new Headers(pe),method:String(l).toUpperCase()},h=0,n=0,g=0,E=0,v=!1,$=!1,B=null,t=null,r=null,C=T=>{let x=()=>{let H=()=>window.fetch(T,s).then(async e=>{if(v)return f.abort(),new Response(null,{status:e.status,statusText:e.statusText,headers:new Headers(e.headers)});if(!e.ok||!r)return e;let o=parseInt(e.headers.get("Content-Length")??0);if(o===0)return e;let y=[],L=0,U=e.body.getReader();for(;;){let{done:G,value:oe}=await U.read();if(G)break;y.push(oe),L+=oe.length,await r(L,o,window.structuredClone?window.structuredClone(y):y)}let W=e.headers.get("Content-Type")??"application/octet-stream";return new Response(new Blob(y,{type:W}),{status:e.status,statusText:e.statusText,headers:new Headers(e.headers)})});if(h===0||v)return H();if(s.method!=="GET")return console.warn("Only method GET can be cached"),H();let c=be(Ie);return c.has(T).then(e=>e?Promise.resolve(e):c.del(T).then(H).then(o=>c.set(T,o,$,h)))};if(n===0||g===0)return x();let A=async()=>{try{return await x()}catch(H){if(H.name===he)throw H;if(g*=2,E++,E>n)throw new Error(`Max retries reached: ${H}`);return console.warn(`Retrying fetch (${E}/${n}): ${T.toString()}`),await new Promise(c=>window.setTimeout(c,g)),A()}};return A()},D=T=>{if(T.status!==200)return Promise.resolve(T);let x=document.querySelector("a[download]");x&&document.body.removeChild(x);let A=T.headers.get("Content-Disposition")?.match(/filename="(.+)"/)?.[1];return T.clone().blob().then(H=>{let c=document.createElement("a"),e=window.URL.createObjectURL(H);return c.href=e,c.download=A||`${t}.${B||(H.type.split("/")?.[1]??"bin")}`,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(e),T})};return{send(T=null){return t&&Object.keys(pe).forEach(x=>s.headers.delete(x)),C(new URL(i,document.body.getAttribute("data-url"))).then(x=>t&&x.ok?D(x).then(A=>({code:A.status,data:A,error:null})):x.json().then(A=>{if(A.error){let H=A.error.at(0),c=x.status>=500;throw new Error(c?`ID: ${A.id}
\u{1F7E5} ${H}`:`\u{1F7E8} ${H}`)}return T&&(A.data=T(A.data)),Object.assign(A,{code:x.status})})).catch(x=>{if(x.name===he)return console.warn("Fetch aborted:",x),x;throw x.name===He&&(x=new Error("\u{1F7E5} Network error or rate limit exceeded")),alert(x.message??String(x)),x})},withCache(T=1e3*60*60*6){return h=T,this},withForceCache(T=1e3*60*60*6){return $=!0,h===0&&(h=T),this},withNoBody(){return v=!0,this},withRetry(T=3,x=1e3){return n=T,g=x,this},withCancel(T){return T==null?this:((async()=>(await T,f.abort()))(),this)},withDownload(T,x=null){return t=T,B=x,this},withProgressFunc(T=null){return r=T,this},default(T=null){return s.headers=new Headers(T??{}),C(i).then(x=>t?D(x):Promise.resolve(x))},token(T){return s.headers.append("Authorization",T),s.headers.append("x-access-key",T),this},body(T){if(s.method==="GET")throw new Error("GET method does not support body");return s.body=JSON.stringify(T),this}}};var le=l=>{let i=new Map,f=new Map,s=be(l),h=1e3*60*60*6,n=!1,g=(r,C)=>{if(!C.ok)throw new Error(C.statusText);return s.set(r,C,n,h)},E=r=>s.has(r),v=r=>s.del(r),$=(r,C=null)=>{if(i.has(r))return Promise.resolve(i.get(r));if(f.has(r))return f.get(r);let D=()=>te("GET",r).withCancel(C).withRetry().default(),T=E(r).then(x=>x?Promise.resolve(x):v(r).then(D).then(A=>g(r,A))).then(x=>x.blob()).then(x=>i.set(r,URL.createObjectURL(x))).then(()=>i.get(r)).finally(()=>f.delete(r));return f.set(r,T),T};return{run:(r,C=null)=>{let D=new Map;return r.length===0?Promise.resolve():(r.filter(T=>T!==null).forEach(T=>{let x=D.get(T.url)??[];D.set(T.url,[...x,[T.res,T?.rej]])}),Promise.allSettled(Array.from(D).map(([T,x])=>$(T,C).then(A=>(x.forEach(H=>H[0]?.(A)),A)).catch(A=>(x.forEach(H=>H[1]?.(A)),A)))))},del:v,has:E,set:g,get:$,open,download:async(r,C)=>{if(!new Map(Array.from(i.entries()).map(([T,x])=>[x,T])).has(r))try{if(!new URL(r).protocol.includes("blob"))throw new Error("Is not blob")}catch{r=await $(r)}return te("GET",r).withDownload(C).default()},setTtl(r){return h=Number(r),this},withForceCache(){return n=!0,this}}};var Me=(()=>{let l=null,i=()=>{let s=document.getElementById("video-love-stroy");if(!s||!s.hasAttribute("data-src"))return s?.remove(),V.complete("video",!0),Promise.resolve();let h=s.getAttribute("data-src");if(!h)return V.complete("video",!0),Promise.resolve();let n=document.createElement("video");n.className=s.getAttribute("data-vid-class"),n.loop=!0,n.muted=!0,n.controls=!1,n.autoplay=!1,n.playsInline=!0,n.preload="metadata";let g=new IntersectionObserver($=>$.forEach(B=>B.isIntersecting?n.play():n.pause())),E=$=>{n.preload="auto",n.controls=!0,n.disableRemotePlayback=!0,n.disablePictureInPicture=!0,n.controlsList="noremoteplayback nodownload noplaybackrate",n.src=URL.createObjectURL($)},v=()=>{let $=document.getElementById("progress-bar-video-love-stroy"),B=document.getElementById("progress-info-video-love-stroy");return te("GET",h).withNoBody().default({Range:"bytes=0-1"}).then(t=>{if(t.status===200)return n.preload="none",n.src=b.escapeHtml(h),s.appendChild(n),Promise.resolve();if(t.status!==206)throw new Error("failed to fetch video");n.addEventListener("error",()=>V.invalid("video"));let r=new Promise(C=>n.addEventListener("loadedmetadata",C,{once:!0}));return n.src=b.escapeHtml(h),s.appendChild(n),r}).then(()=>{n.pause(),n.currentTime=0,V.complete("video");let t=n.getBoundingClientRect().width*(n.videoHeight/n.videoWidth);return n.style.height=`${t}px`,s.style.height=`${t}px`,te("GET",h).withRetry().withProgressFunc((r,C)=>{let D=Number(r/C*100).toFixed(0)+"%";$.style.width=D,B.innerText=D}).default()}).then(t=>t.clone().blob().then(r=>{let C=new Promise(D=>n.addEventListener("loadedmetadata",D,{once:!0}));return E(r),n.load(),C.then(()=>t)})).catch(t=>{$.style.backgroundColor="red",B.innerText="Error loading video",console.error(t)})};return l.has(h).then($=>$?$.blob().then(B=>{let t=new Promise(r=>n.addEventListener("loadedmetadata",r,{once:!0}));return E(B),s.appendChild(n),t.then(()=>V.complete("video"))}):l.del(h).then(v).then(B=>l.set(h,B))).then(()=>{g.observe(n),n.style.removeProperty("height"),s.style.removeProperty("height"),document.getElementById("video-love-stroy-loading")?.remove()})};return{init:()=>(V.add(),l=le("video").withForceCache(),{load:i})}})();var ke=(()=>{let l=null,i=null,f=[],s=t=>new Promise((r,C)=>{let D=new Image;D.onload=()=>r(D),D.onerror=C,D.src=t}),h=(t,r)=>s(r).then(C=>{t.width=C.naturalWidth,t.height=C.naturalHeight,t.classList.remove("opacity-0"),t.src=C.src,C.remove(),V.complete("image")}),n=t=>{f.push({url:t.getAttribute("data-src"),res:r=>h(t,r),rej:r=>{console.error(r),V.invalid("image")}})},g=t=>{t.onerror=()=>V.invalid("image"),t.onload=()=>{t.width=t.naturalWidth,t.height=t.naturalHeight,V.complete("image")},t.complete&&t.naturalWidth!==0&&t.naturalHeight!==0?V.complete("image"):t.complete&&V.invalid("image")},E=()=>Array.from(l).some(t=>t.hasAttribute("data-src")),v=async()=>{let t=Array.from(l),r=async C=>{f.length=0,t.filter(C).forEach(D=>D.hasAttribute("data-src")?n(D):g(D)),await i.run(f,V.getAbort())};await r(C=>C.hasAttribute("fetchpriority")),await r(C=>!C.hasAttribute("fetchpriority"))},$=t=>{i.download(t,`${window.location.hostname}_image_${Date.now()}`)};return{init:()=>(i=le("image").withForceCache(),l=document.querySelectorAll("img:not(.modal-body img)"),l.forEach(V.add),{load:v,download:$,hasDataSrc:E})}})();var Y=l=>{let i=(g=null)=>{let E=JSON.parse(localStorage.getItem(l));return g?E[String(g)]:E},f=(g,E)=>{let v=i();v[String(g)]=E,localStorage.setItem(l,JSON.stringify(v))},s=g=>Object.keys(i()).includes(String(g)),h=g=>{if(!s(g))return;let E=i();delete E[String(g)],localStorage.setItem(l,JSON.stringify(E))},n=()=>localStorage.setItem(l,"{}");return localStorage.getItem(l)||n(),{set:f,get:i,has:s,clear:n,unset:h}};var $e=(()=>{let l=[{title:"Beautiful In White - Shane Filan",src:"./assets/music/Beautiful In White - Shane Filan.mp3"},{title:"A Thousand Years - Christina Perri",src:"./assets/music/A Thousand Years - Christina Perri.mp3"},{title:"I Do - 911",src:"./assets/music/I Do - 911.mp3"},{title:"Marry You - Bruno Mars",src:"./assets/music/Marry You - Bruno Mars.mp3"},{title:"Perfect - Ed Sheeran",src:"./assets/music/Perfect - Ed Sheeran.mp3"},{title:"Sugar - Maroon 5",src:"./assets/music/Sugar - Maroon 5.mp3"},{title:"Until You - Shayne Ward",src:"./assets/music/Until You - Shayne Ward.mp3"},{title:"C\u01B0\u1EDBi nhau \u0111i - B\xF9i Anh Tu\u1EA5n X Hi\u1EC1n H\u1ED3",src:"./assets/music/Cuoi nhau di - Yes I Do - Bui Anh Tuan x Hien Ho.mp3"},{title:"C\u01B0\u1EDBi th\xF4i - Masew x Masiu x B Ray x TAP",src:"./assets/music/Cuoi thoi - Masew x Masiu x B Ray x TAP.mp3"},{title:"GGYDVDBE - Phan M\u1EA1nh Qu\u1EF3nh",src:"./assets/music/Gap go, yeu duong va duoc ben em - Phan Manh Quynh.mp3"},{title:"H\u01A1n c\u1EA3 y\xEAu - \u0110\u1EE9c Ph\xFAc",src:"./assets/music/Hon ca yeu - Duc Phuc.mp3"},{title:"M\u1ED9t nh\xE0 - Da Lab",src:"./assets/music/Mot nha - Da Lab.mp3"},{title:"R\u1ED3i t\u1EDBi lu\xF4n - Nal",src:"./assets/music/Roi toi luon - Nal.mp3"}],i=new Audio;i.crossOrigin="anonymous";let f=null,s=null,h=null,n=0,g=!1,E=!1,v=!1,$=1,B=!1,t={widget:null,toggleBtn:null,panel:null,playBtn:null,title:null,playlistUl:null,playlistContainer:null,vinyl:null,shuffleBtn:null,loopBtn:null},r=()=>{g?(B=!0,c()):B=!1},C=()=>{B&&H()},D=()=>{E&&t.panel&&t.toggleBtn&&(E=!1,t.panel.classList.add("d-none"),g&&t.toggleBtn.classList.add("spin-slow"),t.toggleBtn.innerHTML='<i class="fa-solid fa-compact-disc"></i>')},T=()=>{if(!f){let P=window.AudioContext||window.webkitAudioContext;f=new P,s=f.createGain(),h=f.createMediaElementSource(i),h.connect(s),s.connect(f.destination),s.gain.value=.6}f.state==="suspended"&&f.resume()},x=()=>{V.add();let q=Y("config").get("music_enabled")!==!1;t.widget=document.getElementById("music-player-container"),t.toggleBtn=document.getElementById("music-toggle-btn"),t.panel=document.getElementById("music-panel"),t.playBtn=document.getElementById("btn-play-pause"),t.title=document.getElementById("current-song-title"),t.playlistUl=document.getElementById("playlist-ul"),t.playlistContainer=document.getElementById("playlist-container"),t.vinyl=document.getElementById("vinyl-container"),t.shuffleBtn=document.getElementById("btn-shuffle"),t.loopBtn=document.getElementById("btn-loop"),t.toggleBtn&&t.toggleBtn.addEventListener("click",()=>{if(E)D();else{E=!0,t.panel.classList.remove("d-none"),t.toggleBtn.classList.remove("spin-slow"),t.toggleBtn.innerHTML='<i class="fa-solid fa-xmark"></i>';let J=document.getElementById("particle-controls");J&&J.classList.remove("show")}});let j=document.body.getAttribute("data-audio");return j&&l.length===0&&l.push({title:"Nh\u1EA1c n\u1EC1n",src:j}),i.addEventListener("ended",()=>{$===2?(i.currentTime=0,H()):o(!0)}),p(),q?(A(0),G(),V.complete("audio"),document.addEventListener("undangan.open",()=>{t.widget?.classList.remove("d-none");try{T(),H()}catch(J){console.log("Autoplay blocked",J)}}),{load:()=>{}}):{load:()=>{}}},A=P=>{n=P,i.src=l[n].src,i.load(),t.title&&(t.title.innerText=l[n].title),S()},H=()=>{T(),i.play().then(()=>{g=!0,me(),m()}).catch(P=>console.log("Autoplay blocked or CORS issue"))},c=()=>{i.pause(),g=!1,me(),m()},e=()=>g?c():H(),o=(P=!1)=>{if(P&&$===0&&n===l.length-1&&!v){c();return}if(v){let q=n;if(l.length>1)for(;q===n;)q=Math.floor(Math.random()*l.length);A(q)}else{let q=n+1;q>=l.length&&(q=0),A(q)}H()},y=()=>{let P=n-1;P<0&&(P=l.length-1),A(P),H()},L=P=>{let q=parseFloat(P);s?s.gain.value=q:i.volume=Math.min(q,1)},U=()=>{v=!v,G()},W=()=>{$++,$>2&&($=0),G()},G=()=>{!t.shuffleBtn||!t.loopBtn||(v?t.shuffleBtn.classList.add("active"):t.shuffleBtn.classList.remove("active"),t.loopBtn.className="btn-control small",$===1?t.loopBtn.classList.add("active"):$===2&&t.loopBtn.classList.add("active","loop-one"))},oe=()=>t.playlistContainer.classList.toggle("d-none"),me=()=>{t.playBtn&&(g?(t.playBtn.innerHTML='<i class="fa-solid fa-pause"></i>',E||t.toggleBtn?.classList.add("spin-slow")):(t.playBtn.innerHTML='<i class="fa-solid fa-play"></i>',t.toggleBtn?.classList.remove("spin-slow")))},m=()=>{t.vinyl&&(g?t.vinyl.classList.add("is-playing"):t.vinyl.classList.remove("is-playing"))},p=()=>{t.playlistUl&&(t.playlistUl.innerHTML="",l.forEach((P,q)=>{let j=document.createElement("li");j.className="list-group-item playlist-item",j.innerText=P.title,j.onclick=()=>{A(q),H()},t.playlistUl.appendChild(j)}))},S=()=>{document.querySelectorAll(".playlist-item").forEach((q,j)=>{j===n?q.classList.add("active"):q.classList.remove("active")})};return window.musicPlayer={play:H,pause:c,toggle:e,next:o,prev:y,setVolume:L,togglePlaylist:oe,toggleShuffle:U,toggleLoop:W,closePanel:D,pauseForVideo:r,resumeAfterVideo:C},{init:x,load:()=>{}}})();var Be={tab:f=>window.bootstrap.Tab.getOrCreateInstance(document.getElementById(f)),modal:f=>window.bootstrap.Modal.getOrCreateInstance(document.getElementById(f))};var _e=l=>{let i="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css",f="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js",s=()=>l.get(i).then(n=>new Promise((g,E)=>{let v=document.createElement("link");v.onload=g,v.onerror=E,v.rel="stylesheet",v.href=n,document.head.appendChild(v)})),h=()=>l.get(f).then(n=>new Promise((g,E)=>{let v=document.createElement("script");v.onload=g,v.onerror=E,v.src=n,document.head.appendChild(v)}));return Promise.all([s(),h()]).then(()=>{if(typeof window.AOS>"u")throw new Error("AOS library failed to load");window.AOS.init()})},Re=l=>l.get("https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.js").then(f=>new Promise((s,h)=>{let n=document.createElement("script");n.onerror=h,n.onload=()=>{typeof window.confetti>"u"?h(new Error("Confetti library failed to load")):s()},n.src=f,document.head.appendChild(n)})),Fe=l=>{let i=[{css:"https://fonts.googleapis.com/css2?family=Sacramento&display=swap",family:"Sacramento"},{css:"https://fonts.googleapis.com/css2?family=Noto+Naskh+Arabic&display=swap",family:"Noto Naskh Arabic"},{css:"https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400..700&display=swap",family:"Dancing Script"}],f=({css:s,family:h})=>l.get(s).then(n=>new Promise((g,E)=>{let v=document.createElement("link");v.onload=g,v.onerror=E,v.rel="stylesheet",v.href=n,document.head.appendChild(v)})).then(()=>document.fonts.load(`1em "${h}"`));return Promise.all(i.map(f))},Se=(l={})=>{let i=[],f=le("libs").withForceCache();return(l?.aos??!0)&&i.push(_e(f)),(l?.confetti??!0)&&i.push(Re(f)),(l?.additionalFont??!0)&&i.push(Fe(f)),Promise.all(i)};var ue=(()=>{let l={"#000000":"#ffffff","#ffffff":"#000000","#212529":"#f8f9fa","#f8f9fa":"#212529"},i=["#ffffff","#f8f9fa"],f=["#000000","#212529"],s=!1,h=null,n=null,g=()=>h.set("active","light"),E=()=>h.set("active","dark"),v=x=>{let A=n.getAttribute("content");n.setAttribute("content",x.some(H=>H===A)?l[A]:A)},$=()=>{g(),document.documentElement.setAttribute("data-bs-theme","light"),v(f)},B=()=>{E(),document.documentElement.setAttribute("data-bs-theme","dark"),v(i)},t=(x=null,A=null)=>{let H=h.get("active")==="dark";return x&&A?H?x:A:H};return{init:()=>{switch(h=Y("theme"),n=document.querySelector('meta[name="theme-color"]'),h.has("active")||(window.matchMedia("(prefers-color-scheme: dark)").matches?E():g()),document.documentElement.getAttribute("data-bs-theme")){case"dark":E();break;case"light":g();break;default:s=!0}t()?B():$()},spyTop:()=>{let x=H=>H.filter(c=>c.isIntersecting).forEach(c=>{let e=c.target.classList.contains("bg-white-black")?t(f[0],i[0]):t(f[1],i[1]);n.setAttribute("content",e)}),A=new IntersectionObserver(x,{rootMargin:"0% 0% -95% 0%"});document.querySelectorAll("section").forEach(H=>A.observe(H))},change:()=>t()?$():B(),isDarkMode:t,isAutoMode:()=>s}})();var fe=(()=>{let l={id:"ID",en:"US",fr:"FR",de:"DE",es:"ES",zh:"CN",ja:"JP",ko:"KR",ar:"SA",ru:"RU",it:"IT",nl:"NL",pt:"PT",tr:"TR",th:"TH",vi:"VN",ms:"MY",hi:"IN"},i=null,f=null,s=null,h=null;return{on(n,g){return h.set(n,g),this},get(){let n=h.get(s);return h.clear(),n},getCountry(){return i},getLocale(){return f},getLanguage(){return s},setDefault(n){let g=!0;l[n]||(g=!1,console.warn("Language not found, please add manually in countryMapping")),i=g?l[n]:"US",s=g?n:"en",f=`${s}_${i}`},init(){h=new Map,this.setDefault(navigator.language.split("-").shift())}}})();var ae=(()=>{let l="admin_token",i=()=>localStorage.getItem(l),f=B=>localStorage.setItem(l,B),s=()=>localStorage.removeItem(l),h=()=>{let B=i();return!!B&&B.length>0};return{init:()=>{},guest:B=>Promise.resolve(),isValid:()=>h(),login:(B,t)=>te(xe,t).body(B).send().then(r=>r.code===200&&r.data&&r.data.token?(f(r.data.token),!0):r.code===200&&r.data&&r.data.data&&r.data.data.token?(f(r.data.data.token),!0):r.token?(f(r.token),!0):(console.error("C\u1EA5u tr\xFAc response l\u1EA1:",r),!1)).catch(r=>(console.error("L\u1ED7i Login:",r),!1)),logout:s,decode:()=>{if(!h())return null;try{return JSON.parse(b.base64Decode(i().split(".")[1]))}catch{return null}},isAdmin:h,setToken:f,getToken:i}})();var Ce=(()=>{let l=null,i=!0,f=["input[data-offline-disabled]","button[data-offline-disabled]","select[data-offline-disabled]","textarea[data-offline-disabled]"],s=()=>i,h=()=>{let t=l.firstElementChild.firstElementChild;t.classList.remove("bg-success"),t.classList.add("bg-danger"),t.firstElementChild.innerHTML='<i class="fa-solid fa-ban me-2"></i>Koneksi tidak tersedia'},n=()=>{let t=l.firstElementChild.firstElementChild;t.classList.remove("bg-danger"),t.classList.add("bg-success"),t.firstElementChild.innerHTML='<i class="fa-solid fa-cloud me-2"></i>Koneksi tersedia kembali'},g=async()=>{i&&(await b.changeOpacity(l,!1),h())},E=()=>{document.querySelectorAll(f.join(", ")).forEach(t=>{t.dispatchEvent(new Event(s()?"online":"offline")),t.setAttribute("data-offline-disabled",s()?"false":"true"),t.tagName==="BUTTON"?s()?t.classList.remove("disabled"):t.classList.add("disabled"):s()?t.removeAttribute("disabled"):t.setAttribute("disabled","true")})},v=()=>{i=!1,h(),b.changeOpacity(l,!0),E()},$=()=>{i=!0,n(),b.timeOut(g,3e3),E()};return{init:()=>{window.addEventListener("online",$),window.addEventListener("offline",v),l=document.createElement("div"),l.classList.add("fixed-top","pe-none"),l.style.cssText="opacity: 0; z-index: 1057;",l.innerHTML=`
        <div class="d-flex justify-content-center mx-auto">
            <div class="d-flex justify-content-center align-items-center rounded-pill my-2 bg-danger shadow">
                <small class="text-center py-1 px-2 mx-1 mt-1 mb-0 text-white" style="font-size: 0.8rem;"></small>
            </div>
        </div>`,document.body.insertBefore(l,document.body.lastChild)},isOnline:s}})();var de=(()=>{let l="default",i={128:2,256:3,512:4,768:5},f=null,s=null,h=null,n=null,g=(m,p,S=null)=>{let P=s.get(m);return p.map(q=>{let{id:j,media_formats:{tinygif:{url:J}},content_description:z}=q;P.pointer===-1||P.pointer===P.col-1?P.pointer=0:P.pointer++;let d=P.lists.childNodes[P.pointer]??null;return d?{url:J,res:u=>{d.insertAdjacentHTML("beforeend",`
                <figure class="hover-wrapper m-0 position-relative">
                    <button onclick="undangan.comment.gif.click(this, '${P.uuid}', '${j}', '${b.base64Encode(J)}')" class="btn hover-area position-absolute justify-content-center align-items-center top-0 end-0 bg-overlay-auto p-1 m-1 rounded-circle border shadow-sm z-1">
                        <i class="fa-solid fa-circle-check"></i>
                    </button>
                    <img src="${u}" class="img-fluid" alt="${b.escapeHtml(z)}" style="width: 100%;">
                </figure>`),S?.step()}}:null})},E=m=>f.get(m),v=m=>{let p=s.get(m),S=p.lists,P=document.getElementById(`gif-loading-${p.uuid}`),q=document.getElementById(`progress-bar-${p.uuid}`),j=document.getElementById(`progress-info-${p.uuid}`),J=0,z=0;S.setAttribute("data-continue","false"),S.classList.replace("overflow-y-scroll","overflow-y-hidden");let d=150,a=!1,u=setTimeout(()=>{a||(j.innerText=`${z}/${J}`,S.classList.contains("d-none")||P.classList.replace("d-none","d-flex"))},d);return{release:()=>{a=!0,clearTimeout(u),S.classList.contains("d-none")||P.classList.replace("d-flex","d-none"),q.style.width="0%",j.innerText=`${z}/${J}`,S.setAttribute("data-continue","true"),S.classList.replace("overflow-y-hidden","overflow-y-scroll")},until:_=>{J=_,j.innerText=`${z}/${J}`},step:()=>{z+=1,j.innerText=`${z}/${J}`,q.style.width=Math.min(z/J*100,100).toString()+"%"}}},$=(m,p,S)=>{S={media_filter:"tinygif",client_key:"undangan_app",key:n.get("tenor_key"),country:fe.getCountry(),locale:fe.getLocale(),...S??{}};let P=Object.keys(S).filter(z=>S[z]!==null&&S[z]!==void 0).map(z=>`${z}=${encodeURIComponent(S[z])}`).join("&"),q=v(m),j=s.get(m),J=new Promise(z=>{j.reqs.push(z)});j.last=te("GET",`https://tenor.googleapis.com/v2${p}?${P}`).withCache().withRetry().withCancel(J).default(pe).then(z=>z.json()).then(z=>{if(z.error)throw new Error(z.error.message);return z.results.length===0?z:(j.next=z?.next,q.until(z.results.length),j.gifs.push(...z.results),f.run(g(m,z.results,q),J))}).catch(z=>{z.name===he?console.warn("Fetch abort:",z):b.notify(z).error()}).finally(()=>q.release())},B=m=>(m=b.escapeHtml(m),`
        <label for="gif-search-${m}" class="form-label my-1"><i class="fa-solid fa-photo-film me-2"></i>Gif</label>

        <div class="d-flex mb-3" id="gif-search-nav-${m}">
            <button class="btn btn-secondary btn-sm rounded-4 shadow-sm me-1 my-1" onclick="undangan.comment.gif.back(this, '${m}')" data-offline-disabled="false"><i class="fa-solid fa-arrow-left"></i></button>
            <input dir="auto" type="text" name="gif-search" id="gif-search-${m}" autocomplete="on" class="form-control shadow-sm rounded-4" placeholder="Search for a GIF on Tenor" data-offline-disabled="false">
        </div>

        <div class="position-relative">
            <div class="position-absolute d-flex flex-column justify-content-center align-items-center top-50 start-50 translate-middle w-100 h-100 bg-overlay-auto rounded-4 z-3" id="gif-loading-${m}">
                <div class="progress w-25" role="progressbar" style="height: 0.5rem;" aria-label="progress bar">
                    <div class="progress-bar" id="progress-bar-${m}" style="width: 0%"></div>
                </div>
                <small class="mt-1 text-theme-auto bg-theme-auto py-0 px-2 rounded-4" id="progress-info-${m}" style="font-size: 0.7rem;"></small>
            </div>
            <div id="gif-lists-${m}" class="d-flex rounded-4 p-0 overflow-y-scroll border" data-continue="true" style="height: 15rem;"></div>
        </div>

        <figure class="d-flex m-0 position-relative" id="gif-result-${m}">
            <button onclick="undangan.comment.gif.cancel('${m}')" id="gif-cancel-${m}" class="btn d-none position-absolute justify-content-center align-items-center top-0 end-0 bg-overlay-auto p-2 m-0 rounded-circle border shadow-sm z-1">
                <i class="fa-solid fa-circle-xmark"></i>
            </button>
        </figure>`),t=async m=>{let p=s.get(m);p.reqs.forEach(S=>S()),p.reqs.length=0,p.last&&(await p.last,p.last=null)},r=async m=>{await t(m);let p=s.get(m),S=p.col??0,P=0;for(let[q,j]of Object.entries(i))P=j,p.lists.clientWidth>=parseInt(q)&&(p.col=P);if(p.col===null&&(p.col=P),S!==p.col&&(p.pointer=-1,p.limit=p.col*5,p.lists.innerHTML='<div class="d-flex flex-column"></div>'.repeat(p.col),p.gifs.length!==0)){try{await f.run(g(m,p.gifs))}catch{p.gifs.length=0}S!==p.col&&p.lists.scroll({top:p.lists.scrollHeight,behavior:"instant"}),p.gifs.length===0&&await r(m)}},C=async m=>{let p=s.get(m);if(p.lists.getAttribute("data-continue")!=="true"||!p.next||p.next.length===0)return;let S=p.query&&p.query.trim().length>0,P={pos:p.next,limit:p.limit};S&&(P.q=p.query),p.lists.scrollTop>(p.lists.scrollHeight-p.lists.clientHeight)*.8&&(await r(m),$(m,S?"/search":"/featured",P))},D=async(m,p=null)=>{let S=s.get(m);S.query=p!==null?p:S.query,(!S.query||S.query.trim().length===0)&&(S.query=null),S.col=null,S.next=null,S.pointer=-1,S.gifs.length=0,await r(m),$(m,S.query===null?"/featured":"/search",{q:S.query,limit:S.limit})},T=async(m,p,S,P)=>{let q=b.disableButton(m,b.loader.replace("me-1","me-0"),!0),j=document.getElementById(`gif-result-${p}`);j.setAttribute("data-id",S),j.querySelector(`#gif-cancel-${p}`).classList.replace("d-none","d-flex"),j.insertAdjacentHTML("beforeend",`<img src="${await E(b.base64Decode(P))}" class="img-fluid mx-auto gif-image rounded-4" alt="selected-gif">`),q.restore(),s.get(p).lists.classList.replace("d-flex","d-none"),document.getElementById(`gif-search-nav-${p}`).classList.replace("d-flex","d-none")},x=m=>{let p=document.getElementById(`gif-result-${m}`);p.removeAttribute("data-id"),p.querySelector(`#gif-cancel-${m}`).classList.replace("d-flex","d-none"),p.querySelector("img").remove(),s.get(m).lists.classList.replace("d-none","d-flex"),document.getElementById(`gif-search-nav-${m}`).classList.replace("d-none","d-flex")},A=async(m=null)=>{m?s.has(m)&&(await t(m),h.delete(m),s.delete(m)):(await Promise.allSettled(Array.from(s.keys()).map(p=>t(p))),h.clear(),s.clear())},H=async(m,p)=>{let S=b.disableButton(m,b.loader.replace("me-1","me-0"),!0);await t(p),S.restore(),document.getElementById(`gif-form-${p}`).classList.toggle("d-none",!0),document.getElementById(`comment-form-${p}`)?.classList.toggle("d-none",!1)},c=m=>{if(!s.has(m)){b.safeInnerHTML(document.getElementById(`gif-form-${m}`),B(m));let p=document.getElementById(`gif-lists-${m}`);s.set(m,{uuid:m,lists:p,last:null,limit:null,query:null,next:null,col:null,pointer:-1,gifs:[],reqs:[]});let S=b.debounce(C,150);p.addEventListener("scroll",()=>S(m));let P=b.debounce(D,850);document.getElementById(`gif-search-${m}`).addEventListener("input",q=>P(m,q.target.value))}return document.getElementById(`gif-form-${m}`).classList.toggle("d-none",!1),document.getElementById(`comment-form-${m}`)?.classList.toggle("d-none",!0),h.has(m)&&h.get(m)(),D(m)},e=m=>{let p=document.getElementById(`gif-form-${m}`);return p&&!p.classList.contains("d-none")},o=m=>document.getElementById(`gif-result-${m}`)?.getAttribute("data-id"),y=m=>document.querySelector(`[for="gif-search-${m}"]`)?.remove(),L=m=>document.querySelector(`[onclick="undangan.comment.gif.back(this, '${m}')"]`)?.remove(),U=(m,p)=>h.set(m,p),W=(m=null)=>{let p=document.getElementById(`gif-cancel-${m||l}`);return{show:()=>p.classList.replace("d-none","d-flex"),hide:()=>p.classList.replace("d-flex","d-none"),click:()=>p.dispatchEvent(new Event("click"))}},G=()=>!!n.get("tenor_key"),oe=()=>{document.querySelector('[onclick="undangan.comment.gif.open(undangan.comment.gif.default)"]')?.classList.toggle("d-none",!n.get("tenor_key"))};return{default:l,init:()=>{f=le("gif"),s=new Map,h=new Map,n=Y("config"),document.addEventListener("undangan.session",oe)},get:E,back:H,open:c,cancel:x,click:T,remove:A,isOpen:e,onOpen:U,isActive:G,getResultId:o,buttonCancel:W,removeGifSearch:y,removeButtonBack:L}})();var ve=(()=>{let l=null,i=null,f=null,s=null,h=300,n=()=>`
        <div class="bg-theme-auto shadow p-3 mx-0 mt-0 mb-3 rounded-4">
            <div class="d-flex justify-content-between align-items-center placeholder-wave">
                <span class="placeholder bg-secondary col-5 rounded-3 my-1"></span>
                <span class="placeholder bg-secondary col-3 rounded-3 my-1"></span>
            </div>
            <hr class="my-1">
            <p class="placeholder-wave m-0">
                <span class="placeholder bg-secondary col-6 rounded-3"></span>
                <span class="placeholder bg-secondary col-5 rounded-3"></span>
                <span class="placeholder bg-secondary col-12 rounded-3 my-1"></span>
            </p>
        </div>`,g=e=>`
        <button style="font-size: 0.8rem;" onclick="undangan.comment.like.love(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto ms-auto rounded-3 p-0 shadow-sm d-flex justify-content-start align-items-center" data-offline-disabled="false">
            <span class="my-0 mx-1" data-count-like="${e.like_count}">${e.like_count}</span>
            <i class="me-1 ${i.has(e.uuid)?"fa-solid fa-heart text-danger":"fa-regular fa-heart"}"></i>
        </button>`,E=e=>{let o=`<div class="d-flex justify-content-start align-items-center" data-button-action="${e.uuid}">`;return f.get("can_reply")!==!1&&(o+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.reply('${e.uuid}')" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-offline-disabled="false">Reply</button>`),ae.isAdmin()&&e.is_admin&&(!e.gif_url||de.isActive())?o+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.edit(this, ${e.is_parent?"true":"false"})" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-own="${e.own}" data-offline-disabled="false">Edit</button>`:l.has(e.uuid)&&f.get("can_edit")!==!1&&(!e.gif_url||de.isActive())&&(o+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.edit(this, ${e.is_parent?"true":"false"})" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-offline-disabled="false">Edit</button>`),ae.isAdmin()?o+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.remove(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-own="${e.own}" data-offline-disabled="false">Delete</button>`:l.has(e.uuid)&&f.get("can_delete")!==!1&&(o+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.remove(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-offline-disabled="false">Delete</button>`),o+="</div>",o},v=(e,o)=>{e=b.escapeHtml(e);let y=s.get("show").includes(e);return`<a class="text-theme-auto" style="font-size: 0.8rem;" onclick="undangan.comment.showOrHide(this)" data-uuid="${e}" data-uuids="${b.escapeHtml(o.join(","))}" data-show="${y?"true":"false"}" role="button" class="me-auto ms-1 py-0">${y?"Hide replies":`Show replies (${o.length})`}</a>`},$=e=>`
        <div class="d-flex justify-content-between align-items-center" id="button-${e.uuid}">
            ${E(e)}
            ${e.comments.length>0?v(e.uuid,e.comments.map(o=>o.uuid)):""}
            ${g(e)}
        </div>`,B=e=>!e.ip||!e.user_agent||e.is_admin?"":`
        <div class="mb-1 mt-3">
            <p class="text-theme-auto mb-1 mx-0 mt-0 p-0" style="font-size: 0.7rem;" id="ip-${e.uuid}"><i class="fa-solid fa-location-dot me-1"></i>${b.escapeHtml(e.ip)} <span class="mb-1 placeholder col-2 rounded-3"></span></p>
            <p class="text-theme-auto m-0 p-0" style="font-size: 0.7rem;"><i class="fa-solid fa-mobile-screen-button me-1"></i>${b.parseUserAgent(b.escapeHtml(e.user_agent))}</p>
        </div>`,t=e=>e.is_parent?'class="bg-theme-auto shadow p-3 mx-0 mt-0 mb-3 rounded-4"':`class="${s.get("hidden").find(o=>o.uuid===e.uuid).show?"":"d-none"} overflow-x-auto mw-100 border-start bg-theme-auto py-2 ps-2 pe-0 my-2 ms-2 me-0"`,r=e=>e.is_admin?`<strong class="me-1">${b.escapeHtml(e.name)}</strong><i class="fa-solid fa-certificate text-primary"></i>`:e.is_parent?`<strong class="me-1">${b.escapeHtml(e.name)}</strong><i id="badge-${e.uuid}" data-is-presence="${e.presence?"true":"false"}" class="fa-solid ${e.presence?"fa-circle-check text-success":"fa-circle-xmark text-danger"}"></i>`:`<strong>${b.escapeHtml(e.name)}</strong>`,C=async e=>{let o=`
        <div class="d-flex justify-content-between align-items-center">
            <p class="text-theme-auto text-truncate m-0 p-0" style="font-size: 0.95rem;">${r(e)}</p>
            <small class="text-theme-auto m-0 p-0" style="font-size: 0.75rem;">${e.created_at}</small>
        </div>
        <hr class="my-1">`;if(e.gif_url)return o+`
            <div class="d-flex justify-content-center align-items-center my-2">
                <img src="${await de.get(e.gif_url)}" id="img-gif-${e.uuid}" class="img-fluid mx-auto gif-image rounded-4" alt="selected-gif">
            </div>`;let y=e.comment.length>h,L=b.convertMarkdownToHTML(b.escapeHtml(y?e.comment.slice(0,h)+"...":e.comment));return o+`
        <p dir="auto" class="text-theme-auto my-1 mx-0 p-0" style="white-space: pre-wrap !important; font-size: 0.95rem;" data-comment="${b.base64Encode(e.comment)}" id="content-${e.uuid}">${L}</p>
        ${y?`<p class="d-block mb-2 mt-0 mx-0 p-0"><a class="text-theme-auto" role="button" style="font-size: 0.85rem;" data-show="false" onclick="undangan.comment.showMore(this, '${e.uuid}')">Selengkapnya</a></p>`:""}`},D=async e=>{let o=await C(e),y=await Promise.all(e.comments.map(L=>D(L)));return`
        <div ${t(e)} id="${e.uuid}" style="overflow-wrap: break-word !important;">
            <div id="body-content-${e.uuid}" data-tapTime="0" data-liked="false" tabindex="0">${o}</div>
            ${B(e)}
            ${$(e)}
            <div id="reply-content-${e.uuid}">${y.join("")}</div>
        </div>`};return{init:()=>{l=Y("owns"),i=Y("likes"),f=Y("config"),s=Y("comment")},renderEdit:(e,o,y,L)=>{e=b.escapeHtml(e);let U=document.createElement("div");U.classList.add("my-2"),U.id=`inner-${e}`;let W=`
        <p class="my-1 mx-0 p-0" style="font-size: 0.95rem;"><i class="fa-solid fa-pen me-2"></i>Edit</p>
        ${y?`
        <select class="form-select shadow-sm mb-2 rounded-4" id="form-inner-presence-${e}" data-offline-disabled="false">
            <option value="1" ${o?"selected":""}>&#9989; Datang</option>
            <option value="2" ${o?"":"selected"}>&#10060; Berhalangan</option>
        </select>`:""}
        ${L?`${de.isActive()?`<div class="d-none mb-2" id="gif-form-${e}"></div>`:""}`:`<textarea dir="auto" class="form-control shadow-sm rounded-4 mb-2" id="form-inner-${e}" minlength="1" maxlength="1000" placeholder="Type update comment" rows="3" data-offline-disabled="false"></textarea>    
        `}
        <div class="d-flex justify-content-end align-items-center mb-0">
            <button style="font-size: 0.8rem;" onclick="undangan.comment.cancel(this, '${e}')" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1" data-offline-disabled="false">Cancel</button>
            <button style="font-size: 0.8rem;" onclick="undangan.comment.update(this)" data-uuid="${e}" class="btn btn-sm btn-outline-auto rounded-4 py-0" data-offline-disabled="false">Update</button>
        </div>`;return b.safeInnerHTML(U,W)},renderReply:e=>{e=b.escapeHtml(e);let o=document.createElement("div");o.classList.add("my-2"),o.id=`inner-${e}`;let y=`
        <p class="my-1 mx-0 p-0" style="font-size: 0.95rem;"><i class="fa-solid fa-reply me-2"></i>Reply</p>
        <div class="d-block mb-2" id="comment-form-${e}">
            <div class="position-relative">
                ${de.isActive()?`<button class="btn btn-secondary btn-sm rounded-4 shadow-sm me-1 my-1 position-absolute bottom-0 end-0" onclick="undangan.comment.gif.open('${e}')" aria-label="button gif" data-offline-disabled="false"><i class="fa-solid fa-photo-film"></i></button>`:""}
                <textarea dir="auto" class="form-control shadow-sm rounded-4 mb-2" id="form-inner-${e}" minlength="1" maxlength="1000" placeholder="Type reply comment" rows="3" data-offline-disabled="false"></textarea>
            </div>
        </div>
        <div class="d-none mb-2" id="gif-form-${e}"></div>
        <div class="d-flex justify-content-end align-items-center mb-0">
            <button style="font-size: 0.8rem;" onclick="undangan.comment.cancel(this, '${e}')" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1" data-offline-disabled="false">Cancel</button>
            <button style="font-size: 0.8rem;" onclick="undangan.comment.send(this)" data-uuid="${e}" class="btn btn-sm btn-outline-auto rounded-4 py-0" data-offline-disabled="false">Send</button>
        </div>`;return b.safeInnerHTML(o,y)},renderLoading:n,renderReadMore:v,renderContentMany:e=>Promise.all(e.map(o=>D(o))).then(o=>o.join("")),renderContentSingle:e=>D(e),maxCommentLength:h}})();var Ee=(()=>{let l="/api/wishes",i="https://wedding-invitation-of-hau-and-chin.vercel.app",f=Y("config"),s=[],h=0,n=!0,g=null,E=null,v=async()=>{let c=f.get("comment_lock_enabled")||!1;try{let L=await(await fetch("https://wedding-invitation-of-hau-and-chin.vercel.app/api/config")).json()}catch{}let e=document.getElementById("wishes-form"),o=document.getElementById("btn-send-wish");if(c&&e){e.querySelectorAll("input, textarea, select, button").forEach(L=>L.disabled=!0),o&&(o.innerHTML='<i class="fa-solid fa-lock me-2"></i>\u0110\xE3 \u0111\xF3ng nh\u1EADn l\u1EDDi ch\xFAc',o.classList.replace("btn-primary","btn-secondary")),e.remove();return}H(),D(),T(),$()},$=()=>{let c=document.getElementById("wish-notification");c&&(c.addEventListener("mouseenter",()=>{clearTimeout(g),c.classList.add("is-hovered")}),c.addEventListener("mouseleave",()=>{c.classList.remove("is-hovered"),c.classList.contains("show")&&B(2e3)}),c.addEventListener("touchstart",()=>{clearTimeout(g),c.classList.add("is-touched")},{passive:!0}),c.addEventListener("touchend",()=>{setTimeout(()=>{c.classList.remove("is-touched"),c.classList.contains("show")&&B(5e3)},200)},{passive:!0}))},B=c=>{clearTimeout(g),g=setTimeout(()=>{t()},c)},t=()=>{let c=document.getElementById("wish-notification");c&&(c.classList.remove("show"),c.classList.remove("is-touched"),c.classList.remove("is-hovered"),clearTimeout(E),E=setTimeout(()=>{h++,h>=s.length&&(h=0),h===0&&C(s),r()},3e3))},r=()=>{if(!n)return;let c=document.getElementById("wish-notification"),e=document.getElementById("wish-name"),o=document.getElementById("wish-message");if(!c||s.length===0)return;clearTimeout(g),clearTimeout(E);let y=s[h];e.innerText=y.name,o.innerText=y.message,c.classList.add("show");let L=3e3,U=y.message.length;U<70?L=3e3:U<180?L=6e3:L=9e3,B(L)},C=c=>{for(let e=c.length-1;e>0;e--){let o=Math.floor(Math.random()*(e+1));[c[e],c[o]]=[c[o],c[e]]}return c},D=async()=>{if(Y("config").get("wishes_popup_enabled"))try{let e=await(await fetch(l)).json();if(f.get("wishes_popup_enabled")===!1)return;if(e.result==="success"&&e.data.length>0){let o=e.data.filter(y=>y.message&&y.message.trim()!=="");s=C(o),s.length>0&&n&&setTimeout(r,3e3)}}catch(c){console.error(c)}},T=()=>{let c=document.getElementById("wishes-toggle-button"),e=document.getElementById("wish-notification");c&&c.addEventListener("click",()=>{n=!n,n?(c.classList.add("active"),r()):(c.classList.remove("active"),e&&e.classList.remove("show"),clearTimeout(g),clearTimeout(E))})},x=async c=>{if(!b.ask("B\u1EA1n ch\u1EAFc ch\u1EAFn mu\u1ED1n x\xF3a?"))return;let e=c.getAttribute("data-uuid"),o=b.disableButton(c);(await te(Le,`${i}/api/wishes/${e}`).token(ae.getToken()).send()).code===200?(document.getElementById(e).remove(),b.notify("\u0110\xE3 x\xF3a th\xE0nh c\xF4ng").success()):(o.restore(),b.notify("X\xF3a th\u1EA5t b\u1EA1i").error())},A=()=>(lastRender.forEach(c=>{like.removeListener(c)}),comments.getAttribute("data-loading")==="false"&&(comments.setAttribute("data-loading","true"),comments.innerHTML=ve.renderLoading().repeat(pagination.getPer())),te("GET",`/api/v2/comment?per=${pagination.getPer()}&next=${pagination.getNext()}&lang=${lang.getLanguage()}`).token(ae.getToken()).withCache(1e3*30).withForceCache().send(dto.getCommentsResponseV2).then(async c=>{comments.setAttribute("data-loading","false");for(let y of lastRender)await gif.remove(y);if(c.data.lists.length===0)return comments.innerHTML=onNullComment(),c;let e=y=>y.flatMap(L=>[L.uuid,...e(L.comments)]);lastRender.splice(0,lastRender.length,...e(c.data.lists)),showHide.set("hidden",traverse(c.data.lists,showHide.get("hidden")));let o=await ve.renderContentMany(c.data.lists);return c.data.lists.length<pagination.getPer()&&(o+=onNullComment()),b.safeInnerHTML(comments,o),lastRender.forEach(y=>{like.addListener(y)}),c}).then(async c=>(comments.dispatchEvent(new Event("undangan.comment.result")),c.data.lists&&ae.isAdmin()&&await Promise.all(c.data.lists.map(e=>fetchTracker(e))),pagination.setTotal(c.data.count),comments.dispatchEvent(new Event("undangan.comment.done")),c))),H=()=>{let c=document.getElementById("wishes-form"),e=document.getElementById("btn-send-wish"),o=document.getElementById("success-msg");c&&c.addEventListener("submit",y=>{y.preventDefault();let L=e.innerHTML;e.disabled=!0,e.innerHTML='<i class="fa-solid fa-spinner fa-spin me-2"></i>\u0110ang g\u1EEDi...';let U=new FormData(c),W={};U.forEach((G,oe)=>{W[oe]=G}),fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(W)}).then(G=>G.json()).then(G=>{if(G.result!=="success")throw new Error(G.error||"L\u1ED7i g\u1EEDi kh\xF4ng x\xE1c \u0111\u1ECBnh.");c.reset(),o.classList.remove("d-none"),setTimeout(()=>o.classList.add("d-none"),5e3);let oe={name:W.Ten,message:W.LoiChuc};s.unshift(oe),n&&(h=0,clearTimeout(g),clearTimeout(E),document.getElementById("wish-notification")?.classList.remove("show"),setTimeout(r,600))}).catch(G=>{b.notify("L\u1ED7i g\u1EEDi l\u1EDDi ch\xFAc: "+G.message).error()}).finally(()=>{e.disabled=!1,e.innerHTML=L})})};return{init:v,show:()=>{},send:()=>{}}})();var qe="https://wedding-invitation-of-hau-and-chin.vercel.app",Ne=1.4,Z=[],ne=null,Te=null,ye=0,nn=(()=>{let l=!0,i=null,f=null,s=()=>{let d=new Date(document.body.getAttribute("data-time").replace(" ","T")).getTime(),a=N=>N<10?`0${N}`:`${N}`,u=document.getElementById("day"),w=document.getElementById("hour"),k=document.getElementById("minute"),M=document.getElementById("second"),_=()=>{let N=Math.abs(d-Date.now());u.textContent=a(Math.floor(N/(1e3*60*60*24))),w.textContent=a(Math.floor(N%(1e3*60*60*24)/(1e3*60*60))),k.textContent=a(Math.floor(N%(1e3*60*60)/(1e3*60))),M.textContent=a(Math.floor(N%(1e3*60)/1e3)),b.timeOut(_,1e3-Date.now()%1e3)};b.timeOut(_)},h=()=>{let d=window.location.search.split("to="),a=null;if(d.length>1&&d[1].length>=1&&(a=window.decodeURIComponent(d[1])),a){let w=document.getElementById("guest-name"),k=document.createElement("div");k.classList.add("m-2");let M=`<small class="mt-0 mb-1 mx-0 p-0">${b.escapeHtml(w?.getAttribute("data-message"))}</small><p class="m-0 p-0" style="font-size: 1.25rem">${b.escapeHtml(a)}</p>`;b.safeInnerHTML(k,M),w?.appendChild(k)}let u=document.getElementById("form-name");u&&(u.value=i.get("name")??a)},n=async()=>{let a=document.querySelectorAll(".slide-desktop");if(!a||a.length===0)return;let u=document.getElementById("root")?.querySelector(".d-sm-block");if(!u||(u.dispatchEvent(new Event("undangan.slide.stop")),window.getComputedStyle(u).display==="none"))return;if(a.length===1){await b.changeOpacity(a[0],!0);return}let w=0;for(let[N,X]of a.entries())if(N===w){X.classList.add("slide-desktop-active"),await b.changeOpacity(X,!0);break}let k=!0,M=async()=>(await b.changeOpacity(a[w],!1),a[w].classList.remove("slide-desktop-active"),w=(w+1)%a.length,k&&(a[w].classList.add("slide-desktop-active"),await b.changeOpacity(a[w],!0)),k);u.addEventListener("undangan.slide.stop",()=>{k=!1});let _=async()=>{await M()&&b.timeOut(_,6e3)};b.timeOut(_,6e3)},g=d=>{let a=window.SERVER_CONFIG,u=document.getElementById("particle-toggle-button"),w=document.getElementById("wishes-toggle-button"),k=document.getElementById("wishes-form"),M=document.getElementById("btn-send-wish"),_=document.getElementById("vinyl-container"),N=document.querySelector(".vinyl-grooves"),X=document.querySelector(".vinyl-hole"),K=document.querySelector(".vinyl-needle"),O=document.querySelector(".vinyl-disk"),I=document.getElementById("music-toggle-btn"),F=$e.init();d.disabled=!0,document.body.scrollIntoView({behavior:"instant"}),document.getElementById("root").classList.remove("opacity-0"),ue.isAutoMode()&&document.getElementById("button-theme").classList.remove("d-none"),u&&(a.confetti_enabled?(u.style.display="flex",H()):u.style.display="none");let R=Y("config");if(typeof window.confetti=="function"&&R.get("confetti_enabled")&&(window.confetti(),b.timeOut(window.confetti,1500)),_&&(a.vinyl_enabled?(N?.style.setProperty("display","block"),X?.style.setProperty("display","block"),K?.style.setProperty("display","block"),O?.style.setProperty("display","block"),I?.style.setProperty("display","flex"),F.load(a.music_enabled)):(N?.style.setProperty("display","none"),X?.style.setProperty("display","none"),K?.style.setProperty("display","none"),O?.style.setProperty("display","block"),I?.style.setProperty("display","none"),F.load(!1))),a.can_delete&&k){k.remove(),M&&(M.disabled=!0);let ee=document.getElementById("comment")?.querySelector(".container");ee&&ee.insertAdjacentHTML("afterbegin",'<div class="alert alert-danger rounded-4 shadow-sm text-center">Ch\u1EE9c n\u0103ng G\u1EEDi L\u1EDDi Ch\xFAc \u0111ang b\u1EA3o tr\xEC.</div>')}a.wishes_popup_enabled?(w.style.display="flex",Ee.init()):w.style.display="none",n(),ue.spyTop(),document.dispatchEvent(new Event("undangan.open")),b.changeOpacity(document.getElementById("welcome"),!1).then(ee=>ee.remove())},E=d=>{document.getElementById("button-modal-click").setAttribute("href",d.src),document.getElementById("button-modal-download").setAttribute("data-src",d.src);let a=document.getElementById("show-modal-image");a.src=d.src,a.width=d.width,a.height=d.height,Be.modal("modal-image").show()},v=()=>{document.getElementById("show-modal-image").addEventListener("click",d=>{let a=d.currentTarget.parentNode.querySelector(".position-absolute");a.classList.contains("d-none")?a.classList.replace("d-none","d-flex"):a.classList.replace("d-flex","d-none")})},$=d=>{navigator.vibrate&&navigator.vibrate(500),typeof window.confetti=="function"&&window.confetti({particleCount:50,spread:70,origin:{y:.6}}),b.changeOpacity(d,!1).then(a=>a.remove())},B=()=>i.set("info",!0),t=()=>{document.querySelectorAll(".font-arabic").forEach(d=>{d.innerHTML=String(d.innerHTML).normalize("NFC")})},r=()=>{document.querySelectorAll("svg").forEach(d=>{d.hasAttribute("data-class")&&b.timeOut(()=>d.classList.add(d.getAttribute("data-class")),parseInt(d.getAttribute("data-time")))})},C=()=>{},D=()=>(V.add(),{load:a=>{Se(a).then(()=>V.complete("libs")).catch(()=>V.invalid("libs"))}}),T=async()=>{Y("config").get("confetti_enabled")&&r(),s(),h(),v(),t(),i.has("presence")&&(document.getElementById("form-presence").value=i.get("presence")?"1":"2"),i.get("info")&&document.getElementById("information")?.remove(),await b.changeOpacity(document.getElementById("welcome"),!0),await b.changeOpacity(document.getElementById("loading"),!1).then(u=>u.remove())},x=async()=>{fe.init(),Ce.init(),V.init();let d=Me.init(),a=ke.init(),u=D();i=Y("information"),f=Y("config");let w={confetti_enabled:document.body.getAttribute("data-confetti")==="true"};try{let M=await fetch("/api/config");M.status===200&&(w=(await M.json()).data,Object.entries(w).forEach(([N,X])=>f.set(N,X)))}catch(M){console.warn("L\u1ED7i t\u1EA3i config, d\xF9ng m\u1EB7c \u0111\u1ECBnh:",M)}window.SERVER_CONFIG=w,d.load(),a.load(),u.load(!0,!1),window.addEventListener("resize",b.debounce(n)),document.addEventListener("undangan.progress.done",()=>T()),document.addEventListener("hide.bs.modal",()=>document.activeElement?.blur());let k=document.getElementById("button-modal-download");k&&k.addEventListener("click",M=>{a.download(M.currentTarget.getAttribute("data-src"))})},A=()=>{let d=document.querySelector("#home button.dropdown-toggle");if(d){let R=d.cloneNode(!0);d.parentNode.replaceChild(R,d),new bootstrap.Dropdown(R)}let a="L\u1EC5 C\u01B0\u1EDBi Duy H\u1EADu & Di\u1EC5m Trinh",u="Tr\xE2n tr\u1ECDng k\xEDnh m\u1EDDi b\u1EA1n \u0111\u1EBFn tham d\u1EF1 l\u1EC5 th\xE0nh h\xF4n c\u1EE7a ch\xFAng t\xF4i. S\u1EF1 hi\u1EC7n di\u1EC7n c\u1EE7a b\u1EA1n l\xE0 ni\u1EC1m vinh h\u1EA1nh cho gia \u0111\xECnh ch\xFAng t\xF4i.",w="\u0110\u1ECBa ch\u1EC9 t\u1ED5 ch\u1EE9c s\u1EF1 ki\u1EC7n, ABC, XYZ",k=4,M=document.body.getAttribute("data-time");if(!M)return;let _=new Date(M.replace(/-/g,"/")),N=new Date(_.getTime()+k*60*60*1e3),X=R=>R.toISOString().replace(/-|:|\.\d+/g,""),K=`https://www.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(a)}&dates=${X(_)}/${X(N)}&details=${encodeURIComponent(u)}&location=${encodeURIComponent(w)}`;document.getElementById("google-calendar-link")?.setAttribute("href",K),window.ics.addEvent(a,u,w,_,N);let O="data:text/calendar;charset=utf-8,"+encodeURIComponent(window.ics.build()),I=document.querySelectorAll("#ics-calendar-link, #outlook-calendar-link, #yahoo-calendar-link"),F="dam-cuoi.ics";I.forEach(R=>{R.setAttribute("href",O),R.setAttribute("download",F)})},H=()=>{let d=document.getElementById("particle-toggle-button"),a=document.getElementById("particle-controls"),u=document.getElementById("particle-shape"),w=document.getElementById("particle-duration"),k=document.getElementById("particle-size"),M=document.getElementById("particle-density");if(!d||!a)return;let _=null,N=null,X=()=>{if(typeof window.confetti!="function")return;let I=u.value,F=parseFloat(k.value),R=parseInt(M.value),ee=["M22 11h-4.17l2.08-2.08c.39-.39.39-1.02 0-1.41-.39-.39-1.02-.39-1.41 0L14.91 11H9.09l-3.59-3.59c-.39-.39-1.02-.39-1.41 0-.39.39-.39 1.02 0 1.41L6.17 11H2c-.55 0-1 .45-1 1s.45 1 1 1h4.17l-2.08 2.08c-.39.39-.39 1.02 0 1.41.2.2.45.29.71.29s.51-.1.71-.29l3.59-3.59h5.82l3.59 3.59c.2.2.45.29.71.29s.51-.1.71-.29c.39-.39.39-1.02 0-1.41L17.83 13H22c.55 0 1-.45 1-1s-.45-1-1-1z","M11.99 2L2 7.77v11.54L11.99 25.08l9.99-5.77V7.77L11.99 2zM12 22.4l-8-4.62v-9.24l8-4.62l8 4.62v9.24l-8 4.62z","M21 11h-.77c.69-1.36 1.45-2.29 1.48-2.32a.992.992 0 0 0-.28-1.39c-.47-.27-1.08-.11-1.36.36-.03.05-.83 1.27-1.63 2.88L15.76 5.9c1.61-.8 2.83-1.6 2.88-1.63.47-.28.63-.89.36-1.36a1.003 1.003 0 0 0-1.39-.28c-.03.03-.96.79-2.32 1.48V3c0-.55-.45-1-1-1s-1 .45-1 1v1.11c-1.36-.69-2.29-1.45-2.32-1.48a.992.992 0 0 0-1.39.28c-.27.47-.11 1.08.36 1.36.05.03 1.27.83 2.88 1.63L8.24 10.53c-1.61-.8-2.83-1.6-2.88-1.63-.47-.27-1.08-.11-1.36.36-.28.47-.11 1.09.36 1.36.03.03.79.96 1.48 2.32H5c-.55 0-1 .45-1 1s.45 1 1 1h.83c-.69 1.36-1.45 2.29-1.48 2.32-.27.47-.11 1.08.36 1.36.19.11.39.17.6.17.31 0 .62-.12.8-.39.05-.03 1.27-.83 2.88-1.63l2.68 4.64c-1.61.8-2.83 1.6-2.88 1.63-.47.28-.63.89-.36 1.36.17.29.49.47.82.47.18 0 .36-.06.53-.16.03-.03.96-.79 2.32-1.48V23c0 .55.45 1 1 1s1-.45 1-1v-1.11c1.36.69 2.29 1.45 2.32 1.48.17.1.35.16.53.16.34 0 .65-.17.82-.47.27-.47.11-1.08-.36-1.36-.05-.03-1.27-.83-2.88-1.63l2.68-4.64c1.61.8 2.83 1.6 2.88 1.63.18.11.38.16.57.16.32 0 .63-.13.82-.4.27-.47.11-1.08-.36-1.36-.03-.03-.79-.96-1.48-2.32H21c.55 0 1-.45 1-1s-.45-1-1-1zm-9 1.83l-2.2-3.81 3.81 2.2-1.61.93v1.61zm-1.61-5.66l2.2 3.81-3.81-2.2 1.61-.93V7.17zM9.17 13l3.81 2.2-2.2-3.81-.93 1.61H8.24zm5.66 1.61l-2.2-3.81 3.81 2.2-1.61.93h-1.68z"],re=["M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z","M12,2L14.5,9.5L22,12L14.5,14.5L12,22L9.5,14.5L2,12L9.5,9.5L12,2Z","M12 2l2.4 7.2h7.6l-6 4.8 2.4 7.2-6-4.8-6 4.8 2.4-7.2-6-4.8h7.6z"],se=["M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z","M12 21.593c-5.63-5.539-11-10.297-11-14.402 0-3.791 3.068-5.191 5.281-5.191 1.312 0 4.151.501 5.719 4.457 1.59-3.968 4.464-4.447 5.726-4.447 2.54 0 5.274 1.621 5.274 5.181 0 4.069-5.136 8.625-11 14.402m5.726-20.583c-2.203 0-4.446 1.042-5.726 3.238-1.285-2.206-3.522-3.248-5.719-3.248-3.183 0-6.281 2.187-6.281 6.191 0 4.661 5.571 9.429 12 15.809 6.43-6.38 12-11.148 12-15.809 0-4.011-3.095-6.181-6.274-6.181"],ge=["M0 0h24v10H0z","M0 0h12v12H0z","M12 2L2 22h20L12 2z"],ce=Ae=>Ae.map(Pe=>window.confetti.shapeFromPath({path:Pe})),Q={particleCount:R/5,angle:90,spread:180,origin:{x:Math.random(),y:Math.random()-.2},flat:!0,gravity:.5,drift:Math.random()*.5-.25,disableForReducedMotion:!0,zIndex:9999};switch(I){case"svg-heart":Q.shapes=ce(se),Q.colors=["#FFC0CB","#FF69B4","#FF1493","#C71585","#DC143C","#FFFFFF"],Q.scalar=F*2;break;case"stars":Q.shapes=ce(re),Q.colors=["#FFD700","#FDB813","#FFFACD","#E5C100","#FFFFFF"],Q.scalar=F*1.5;break;case"snow":Q.shapes=ce(ee),Q.colors=["#FFFFFF","#E0FFFF","#CAE9F5","#F0F8FF"],Q.scalar=F*1.5,Q.drift=Math.random()*1-.5,Q.gravity=.35;break;case"confetti":default:Q.shapes=ce(ge),Q.scalar=F*1.2;break}window.confetti(Q)},K=()=>{_&&clearInterval(_),N&&clearTimeout(N);let I=parseInt(w.value);if(I===0)return;I>0&&(N=setTimeout(()=>{_&&clearInterval(_)},I*1e3));let F=parseInt(M.value),R=Math.max(5e4/F,500);_=setInterval(X,R)};d.addEventListener("click",()=>{window.musicPlayer&&typeof window.musicPlayer.closePanel=="function"&&window.musicPlayer.closePanel(),console.log("Toggling particle controls panel."),a.classList.toggle("show")}),[u,w,k,M].forEach(I=>{I.addEventListener("change",K)});function O(){typeof window.confetti=="function"?K():setTimeout(O,100)}O()},c=async(d="webp")=>{let a=`gallery_images_${d}`,u=localStorage.getItem(a);if(u){let w=JSON.parse(u);if(new Date().getTime()-w.timestamp<3600*1e3)return console.log("Load danh s\xE1ch \u1EA3nh t\u1EEB LocalStorage (Kh\xF4ng t\u1ED1n l\u01B0\u1EE3t g\u1ECDi API)"),Te=w.files,w.files}try{console.log("G\u1ECDi API Vercel l\u1EA5y danh s\xE1ch...");let w=`${qe}/api/gallery?ext=${d}`,k=await fetch(w);if(!k.ok)throw new Error(`Status ${k.status}`);let M=await k.json();return M.success&&M.files.length>0?(Te=M.files,localStorage.setItem(a,JSON.stringify({files:M.files,timestamp:new Date().getTime()})),M.files):[]}catch(w){return console.error("L\u1ED7i t\u1EA3i \u1EA3nh:",w),[]}},e=null,o=null,y=null;function L(d=0){if(!Te&&typeof c=="function"){c().then(()=>L(d));return}else if((!Z||Z.length===0)&&!(typeof Z<"u"&&Z.length>0))return;let a=document.getElementById("detailModal");(a.style.display="none")&&(a.style.display="block"),e=new bootstrap.Modal(a);let u=document.getElementById("detail-thumbnails");o=document.getElementById("detail-fullscreen-image"),e||(e=bootstrap.Modal.getInstance(a)||new bootstrap.Modal(a)),u.dataset.rendered||(u.innerHTML="",Z.forEach((O,I)=>{let F=document.createElement("img");F.src=O,F.className="rounded-3 shadow-sm cursor-pointer mx-1",F.style.cssText=`
                width: 60px;
                height: 60px;
                object-fit: cover;
                opacity: 0.6;
            `,F.onclick=()=>U(I),F.oncontextmenu=R=>R.preventDefault(),u.appendChild(F)}),u.dataset.rendered="1"),y=u.querySelectorAll("img"),U(d),a.classList.contains("show")||e.show();let w=1,k=0,M=0,_=null,N=0,X=0,K=0;o.style.transition="transform 0.2s ease-out",o.style.transform="scale(1) translate(0,0)",o.ontouchstart=O=>{if(O.touches.length===2){let I=O.touches[0].pageX-O.touches[1].pageX,F=O.touches[0].pageY-O.touches[1].pageY;_=Math.hypot(I,F)}else O.touches.length===1&&w>1&&(N=O.touches[0].pageX-k,X=O.touches[0].pageY-M);K=O.touches[0].clientX},o.ontouchmove=O=>{if(O.preventDefault(),O.touches.length===2&&_){let I=O.touches[0].pageX-O.touches[1].pageX,F=O.touches[0].pageY-O.touches[1].pageY,R=Math.hypot(I,F);w=Math.min(4,Math.max(1,w*(R/_))),o.style.transform=`scale(${w}) translate(${k}px,${M}px)`,_=R}else O.touches.length===1&&w>1&&(k=O.touches[0].pageX-N,M=O.touches[0].pageY-X,o.style.transform=`scale(${w}) translate(${k}px,${M}px)`)},o.ontouchend=O=>{if(_=null,w===1&&O.changedTouches.length===1){let I=O.changedTouches[0].clientX-K;Math.abs(I)>50&&W(I<0?1:-1)}}}function U(d){d<0||d>=Z.length||(ye=d,o.src=Z[d],o.oncontextmenu=a=>a.preventDefault(),y.forEach((a,u)=>{a.style.border=u===d?"3px solid #ff4081":"none",a.style.opacity=u===d?1:.6}))}function W(d){let a=Z.length;if(a===0)return;let u=(ye+d+a)%a;L(u)}async function G(d="webp"){let a=document.getElementById("albumModal"),u=document.getElementById("book");if(ne){new bootstrap.Modal(a).show();return}if(!u){let M=a.querySelector(".modal-body");if(!M)return console.error("modal-body kh\xF4ng t\u1ED3n t\u1EA1i!");M.insertAdjacentHTML("afterbegin",'<div id="book" style="display:none"></div>'),u=document.getElementById("book")}let w=await c(d);if(Z=w,!w.length)return;ne&&(ne.destroy(),ne=null),u.innerHTML="",u.style.display="block",new bootstrap.Modal(a).show(),a.addEventListener("shown.bs.modal",()=>{if(ne)return;u.style.display="block",u.innerHTML="";let M=window.innerWidth,_=Math.min(1e3,M*.95),N=_/Ne,X=_/2,K=Z.map((I,F)=>{let R=document.createElement("div");return R.className="my-page",R.dataset.pageIndex=F,(F===0||F===Z.length-1)&&(R.dataset.density="hard"),R.innerHTML=`<img src="${I}" style="width:100%;height:100%;object-fit:cover">`,R});ne=new St.PageFlip(u,{width:X,height:N,size:"fixed",drawShadow:!0,flippingTime:800,showCover:!0,usePortrait:!0,startZIndex:1,maxShadowOpacity:.5,showPageCorners:!0,disableFlipByClick:!1}),ne.loadFromHTML(K);function O(){document.querySelectorAll(".my-page").forEach(I=>{if(I.dataset.hasHandlers)return;I.dataset.hasHandlers="1";let F=parseInt(I.dataset.pageIndex),R=null;I.addEventListener("click",se=>{if(R!==null){clearTimeout(R),R=null,se.stopImmediatePropagation(),se.preventDefault();return}R=setTimeout(()=>{R=null},1e3)}),I.addEventListener("dblclick",se=>{se.preventDefault(),se.stopImmediatePropagation(),R!==null&&(clearTimeout(R),R=null),L(F)});let ee=0,re=null;I.addEventListener("touchend",se=>{let ge=Date.now(),ce=ge-ee;if(ce>0&&ce<500){se.preventDefault(),se.stopImmediatePropagation(),re&&(clearTimeout(re),re=null),L(F),ee=0;return}ee=ge,re=setTimeout(()=>{re=null},500)})})}ne.on("init",O),ne.on("flip",O),ne.on("changeState",O),u.addEventListener("dblclick",I=>{O()})},{once:!0})}function oe(d){let a=0,u=w=>{let k=w.target.closest(".my-page")||w.target.querySelector(".my-page");if(!k){console.log("pageEl not found",w.target);return}let M=new Date().getTime(),_=M-a,N=w.target.closest(".zoom-indicator");if(_<300&&_>0||N){w.preventDefault(),w.stopPropagation();let X=parseInt(k.dataset.pageIndex);L(X),a=0;return}a=M};d.addEventListener("click",u),d.addEventListener("touchend",u)}function me(){let d=document.getElementById("albumModal"),a=document.getElementById("book"),u=bootstrap.Modal.getInstance(d);u?u.hide():(d.classList.remove("show"),d.style.display="none",d.removeAttribute("role"),d.removeAttribute("aria-modal")),setTimeout(()=>{p()},300)}function m(d){let a=new bootstrap.Modal(document.getElementById("detailModal")),u=document.getElementById("detail-fullscreen-image");u.src=Z[d];let w=d,k=1,M=0,_=0,N=null,X=0,K=0;u.style.transform="scale(1) translate(0,0)",u.style.transition="transform 0.2s ease-out",a.show(),u.ontouchstart=I=>{if(I.touches.length===2){let F=I.touches[0].pageX-I.touches[1].pageX,R=I.touches[0].pageY-I.touches[1].pageY;N=Math.hypot(F,R)}else I.touches.length===1&&k>1&&(X=I.touches[0].pageX-M,K=I.touches[0].pageY-_)},u.ontouchmove=I=>{if(I.preventDefault(),I.touches.length===2&&N){let F=I.touches[0].pageX-I.touches[1].pageX,R=I.touches[0].pageY-I.touches[1].pageY,ee=Math.hypot(F,R);k*=ee/N,k=Math.max(1,Math.min(k,4)),u.style.transform=`scale(${k}) translate(${M}px,${_}px)`,N=ee}else I.touches.length===1&&k>1&&(M=I.touches[0].pageX-X,_=I.touches[0].pageY-K,u.style.transform=`scale(${k}) translate(${M}px,${_}px)`)},u.ontouchend=()=>{N=null};let O=0;u.addEventListener("touchstart",I=>{I.touches.length===1&&(O=I.touches[0].clientX)}),u.addEventListener("touchend",I=>{let F=I.changedTouches[0].clientX-O;Math.abs(F)>50&&(F<0?w=Math.min(w+1,Z.length-1):w=Math.max(w-1,0),u.src=Z[w],k=1,M=0,_=0,u.style.transform="scale(1) translate(0,0)")})}function p(){document.querySelectorAll(".modal-backdrop").forEach(a=>a.remove()),document.body.style.overflow="auto",document.body.style.height="auto",document.body.classList.remove("modal-open"),document.body.style.paddingRight="0px",document.documentElement.style.height="auto"}function S(){let d=document.querySelectorAll(".timeline-section-center, .timeline-row"),a={root:document.getElementById("storyTimelineModal"),threshold:.15,rootMargin:"0px 0px -50px 0px"},u=new IntersectionObserver(w=>{w.forEach(k=>{k.isIntersecting&&k.target.classList.add("visible")})},a);d.forEach(w=>{u.observe(w)})}function P(){document.getElementById("storyTimelineModal").classList.add("active"),document.body.classList.add("modal-open"),setTimeout(()=>{S()},300)}function q(){document.getElementById("storyTimelineModal").classList.remove("active"),document.body.classList.remove("modal-open")}function j(d,a){window.musicPlayer&&typeof window.musicPlayer.pauseForVideo=="function"&&window.musicPlayer.pauseForVideo();let u=document.getElementById("videoPlayerModal"),w=document.getElementById("youtubePlayerContainer"),k=document.getElementById("playerTitle");k&&(k.innerText=a);let M=`
        <iframe 
            src="https://www.youtube-nocookie.com/embed/${d}?autoplay=1&rel=0&modestbranding=1&playsinline=1&origin=${window.location.origin}&loop=1&playlist=${d}" 
            title="YouTube video player" 
            frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
            referrerpolicy="strict-origin-when-cross-origin"
            allowfullscreen 
            class="w-100 h-100 absolute top-0 left-0">
        </iframe>
    `;w.innerHTML=M,u.classList.add("active"),document.body.classList.add("modal-open")}function J(){let d=document.getElementById("videoPlayerModal"),a=document.getElementById("youtubePlayerContainer");d.classList.remove("active"),setTimeout(()=>{a.innerHTML=""},300),window.musicPlayer&&typeof window.musicPlayer.resumeAfterVideo=="function"&&window.musicPlayer.resumeAfterVideo(),document.getElementById("storyTimelineModal").classList.contains("active")||document.body.classList.remove("modal-open")}return document.addEventListener("keydown",function(d){d.key==="Escape"&&(document.getElementById("videoPlayerModal").classList.contains("active")?J():document.getElementById("storyTimelineModal").classList.contains("active")&&q())}),{init:()=>(ue.init(),ae.init(),ae.isAdmin()&&(Y("user").clear(),Y("owns").clear(),Y("likes").clear(),Y("session").clear(),Y("comment").clear()),window.addEventListener("load",()=>{we.init(x,["image","video","audio","libs","gif"]),A()}),window.navigateDetail=function(d){let a=Z.length;if(!a)return;let u=(ye+d+a)%a,w=document.getElementById("detail-thumbnails");w&&w.dataset.rendered?U(u):L(u)},window.closeDetailModal=function(){let d=document.getElementById("detailModal"),a=document.getElementById("detail-fullscreen-image");d&&(d.style.display="none"),a&&(a.style.transform="scale(1) translate(0,0)"),setTimeout(()=>{let u=document.getElementById("albumModal");(!u||!u.classList.contains("show"))&&(document.querySelectorAll(".modal-backdrop").forEach(w=>w.remove()),document.body.classList.remove("modal-open"),document.body.style.overflow="")},300),ne&&setTimeout(()=>{try{ne.flip(ye)}catch{}},300)},{util:b,theme:ue,comment:Ee,guest:{open:g,modal:E,showStory:$,closeInformation:B,openAlbum:G,openDetail:m,closeDetailModal2:me,openStoryTimeline:P,openDetailModal:L,closeStoryTimeline:q,closeVideoPlayer:J,playVideo:j}})}})();})();
